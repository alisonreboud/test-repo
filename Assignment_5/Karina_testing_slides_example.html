<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <meta name="viewport" content="width=device-width">
  <style>
          html {
        height:100%;
        overflow:hidden;
      }

      body {
        margin:0;
        height:100%;
        overflow:hidden;
      }

      svg {
        width:100%;
        height:100%;
        position:absolute;
        top:0px;
        left:0px;
      }
  </style>
</head>
<body>
  <svg>
    <script>
  d3.select(window).on('load', init);

var unemployment = d3.map();  

function init() {

    var svg = d3.select('svg')
    var margin = {top: 50, right: 50, bottom: 200, left: 50};
    var width = +svg.node().getBoundingClientRect().width - margin.left - margin.right;
    var height = +svg.node().getBoundingClientRect().height - margin.top - margin.bottom;

    var g = svg.append("g")
               .attr("transform", 
                     "translate(" + margin.left + "," + margin.top + ")");

    var scale = d3.scaleLinear()
                  .range([0, width])
                  .domain([0,1000]);

    var projection = d3.geoTransform({
      point: function(px, py) {
        this.stream.point(scale(px), scale(py));
      }
    });
  
    // Setup path generator
    var path = d3.geoPath().projection(projection);

    // Define color range
    var color = d3.scaleThreshold()
                  .domain(d3.range(2, 10))
                  .range(d3.schemeReds[9]);  
  
    d3.queue()
      .defer(d3.json, "https://d3js.org/us-10m.v1.json")
      .defer(d3.tsv, "https://gist.githubusercontent.com/mbostock/4060606/raw/unemployment.tsv",
             function(d) {unemployment.set(d.id, +d.rate);})
      .await(ready);
      
    function ready(error, data) {

      if (error) throw error;
            
      var counties = topojson.feature(data, data.objects.counties).features;

      g.append("g")
       .attr("class", "counties")
       .selectAll("path")
       .data(counties)
       .enter()
       .append("path")
       .attr("d", path)
       .attr("stroke", "#aaa")
       .attr("stroke-width", "0.1")
    }
}
  
  </script>
    </svg>
</body>
</html>
